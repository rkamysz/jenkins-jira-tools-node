module.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=13)}([function(e,t){e.exports={happy:"( •‿•)⊃━☆ﾟ.*･｡ﾟ  ",crying:"( ಥ_ಥ)⊃━☆ﾟ.*･｡ﾟ  ",ups:"('⊙＿⊙)⊃━☆ﾟ.*･｡ﾟ  ",hurrah:"( ＾∇＾)⊃━☆ﾟ.*･｡ﾟ  ",focused:"(∩｀-´)⊃━☆ﾟ.*･｡ﾟ  "}},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("arkan.js")},function(e,t){e.exports=require("xml-parse")},function(e,t,n){const o=n(3),r=n(1),i=n(0),s=function(e,t){let n=[];return e?(n=function(e,t){for(var n,o,r,i=new RegExp(t,"g"),s=[],c=0;c<e.length;c++){o=e[c];for(var a=0;a<o.childNodes.length;a++)"comment"===(r=o.childNodes[a]).tagName&&null!==(n=i.exec(r.innerXML))&&s.push(n[0])}return s}(e.childNodes,t),console.log(`${i.happy}Found ${n.length} tickets`)):console.log(`${i.ups}No tickets found`),[]};Jira.prototype.getTicketsIds=function(e){return console.log(`${i.focused}find Jira tickets in Jenkins build log.`),r(_config.buildXMLUrl).then(e=>o.parse(e.text())).then(e=>(function(e){let t;for(let n=0;n<e.length;n++)if("changeSet"===(t=e[n]).tagName)return t;return null})(e[0].childNodes)).then(e=>s(e,_config.ticketIdPattern)).catch(e=>(console.error(i.crying,e),[]))},e.exports=new function(e){if(!e)throw new Error("Missing Jenkins config.")}(config)},function(e,t){e.exports={getRequestBody:function(e,t){var n={transition:{id:e},fields:{},update:{}};return t&&(void 0!==t.assignee&&(n.fields.assignee={name:t.assignee}),t.resolution&&(n.fields.resolution={name:t.resolution}),t.comment&&(n.update.comment=[{add:{body:t.comment}}])),JSON.stringify(n)}}},function(e,t){e.exports={getRequestBody:function(e){return e||(e=""),`{"update":{"assignee":[{"set":{"name":"${e}"}}]}}`}}},function(e,t){e.exports=require("fs")},function(e,t,n){const o=n(7);e.exports={getVersionId:function(e){if(e.id)return e.id;throw new Error(`'id' not found in requests result: ${e}`)},getVersionFromPackageJson:function(){var e=o.readFileSync("package.json","utf8");if(e){var t=JSON.parse(e),n=new RegExp("[^/]*$","g");return t.name.match(n)[0]+"@"+t.version}},getRequestBody:function(e){return e.project=e.project||_config.project,e.name=e.name||this.getVersionFromPackageJson(),JSON.stringify(e)}}},function(e,t,n){const o=n(1),r=function(e,t,n){_jiraUrl=n,_auth64=Buffer.from(`${e}:${t}`).toString("base64"),_headers={"Content-Type":"application/json",Authorization:`Basic ${_auth64}`},_call=function(e,t,n,r){return o(_jiraUrl+e,{method:t,headers:_headers,body:n}).then(e=>i(e,r))}},i=function(e,t){if(s(e,t))throw new Error(e.status);return e.json()},s=function(e,t){return e instanceof Error||t&&e.status!=t};r.prototype.post=function(e,t,n){return _call(e,"POST",t,n)},r.prototype.put=function(e,t,n){return _call(e,"PUT",t,n)},r.prototype.get=function(e,t,n){return _call(e,"GET",t,n)},e.exports=r},function(e,t,n){n(9);const o=n(0),r=n(8),i=n(6),s=n(5);function c(e){if(!e)throw new Error("Missing JIRA config.");let t=e;new JiraFetch(t.user,t.password,t.url)}c.prototype.createVersion=function(e){return console.log(`${o.focused}create new version in Jira`),_jiraFetch.post("/version",r.getRequestBody(e),201).then(e=>r.getVersionId(e)).catch(t=>console.log(`${o.crying} Version ${e.name} has not been added. `,t))},c.prototype.changeTicketFixVersion=function(e,t){return console.log(`${o.focused}update fixVersions in Jira tickets`),_jiraFetch.put(`/issue/${e}`,`{"update":{"fixVersions":[{"add":{"id":"${t}"}}]}}`,204).then(n=>console.log(`${o.happy}Ticket ${e} has been updated with new version ${t}`)).catch(t=>console.log(`${o.crying}Ticket ${e} has not been updated.`,t))},c.prototype.getTicketTransitions=function(e){return _jiraFetch.get(`/issue/${e}/transitions`,"",200).catch(e=>console.log(`${o.crying}I couldn't get transitions.`,e))},c.prototype.changeTicketTransitions=function(e,t,n){return console.log(`${o.focused}change Jira ticket status`),_jiraFetch.post(`/issue/${e}/transitions`,s.getRequestBody(t,n),204).catch(t=>console.log(`${o.crying}Status of ${e} has not been changed.`,t))},c.prototype.getAllTicketsTypes=function(){return console.log(`${o.focused}get all tickets types`),_jiraFetch.get("/issuetype","",200).catch(e=>(console.log(`${o.crying} Ticket types not received.`,e),[]))},c.prototype.getTicketType=function(e){return console.log(`${o.focused}get ticket type`),_jiraFetch.get(`/issuetype/${e}`,"",200).catch(e=>(console.log(`${o.crying}Ticket types not received.`,e),{}))},c.prototype.assignTicketTo=function(e,t){return console.log(`${o.focused}assign Jira ticket to the user`),_jiraFetch.put(`/issue/${e}`,i.getRequestBody(t),204).catch(t=>console.log(`${o.crying}Ticket ${e} has not been assigned.`,t))},c.prototype.addCommentToTicket=function(e,t){return console.log(`${o.focused}add comment to the Jira ticket`),_jiraFetch.post(`/issue/${e}/comment`,`{"body":"${t}"}`,201).catch(t=>console.log(o.crying+"Coment has not been added to the ticket "+e+".",t))},e.exports=new c(config)},function(e,t,n){function o(e){n(10)(e.jira),n(4)(e.jenkins)}o.prototype.findTickets=function(){return _jenkins.getTicketsIds()},o.prototype.createVersion=function(e){return _jira.createVersion(e)},o.prototype.updateFixVersions=function(e,t){return Promise.all(e.map(e=>_jira.changeTicketFixVersion(e,t)))},o.prototype.assignTo=function(e,t){return Promise.all(e.map(e=>_jira.assignTicketTo(e,t)))},o.prototype.addComment=function(e,t){return Promise.all(e.map(e=>_jira.addCommentToTicket(e,t)))},o.prototype.changeStatus=function(e,t){return getStatusChangeMethod(typeof t)(_jira,e,t)},e.exports=new o(config)},function(e,t){e.exports.getFormatedDate=function(){var e=(new Date).toString().split(" ");return[e[2],e[1],e[3]].join("/")},e.exports.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},function(e,t,n){const o=n(2).Arkan,r=n(2).args,i=n(12).isNumeric,s=function(e){_app=n(11)(e),_arkan=new o};s.prototype.findTickets=function(e){return _arkan.run(_app.findTickets,[],"tickets").run(t=>{t.forEach(t=>{e.push(t)})},[r("tickets")]),this},s.prototype.createVersion=function(e,t){return _arkan.run(_app.createVersion,[e],"versionId").run(e=>{t(e)},[r("versionId")]),this},s.prototype.updateFixVersions=function(e,t){return _arkan.run(_app.updateFixVersions,[e,i(t)?t:r("versionId")]),this},s.prototype.changeStatus=function(e,t){return _arkan.run(_app.changeStatus,[e,t]),this},s.prototype.assignTo=function(e,t){return _arkan.run(_app.assignTo,[e,t]),this},s.prototype.addComment=function(e,t){return _arkan.run(_app.addComment,[e,t]),this},e.exports=s}]);